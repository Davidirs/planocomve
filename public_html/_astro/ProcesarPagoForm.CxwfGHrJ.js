import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as o}from"./index.BVOCwoKb.js";import{a as j,t as w,b as T}from"./axios.BvopIwSP.js";function z(){const[r,b]=o.useState({pm_ced:"",pm_tel:"",pm_fecha:new Date().toISOString().split("T")[0],pm_banco_origen:"",transaccion:"",total:"",descripcion:"",forma_pago:"Pago movil",descripcion_pago:"Personal - Banco de Venezuela - 0102"}),[g,x]=o.useState(""),[c,k]=o.useState(null),[B,u]=o.useState(!0),[v,m]=o.useState(null),[h,C]=o.useState(!1),[O,I]=o.useState(""),[p,S]=o.useState(null),[f,P]=o.useState(null),[_,D]=o.useState(!1),[n,y]=o.useState(null);o.useEffect(()=>{(async()=>{u(!0),m(null);const a=new URLSearchParams(window.location.search).get("id");if(!a){m("No se encontró el ID de la factura."),u(!1);return}try{const[l,d]=await Promise.all([fetch(`${j}/api/v1/GetInvoice`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:w,idfactura:a})}),fetch(`${j}/cliente/ajax/bdv/pasarelas`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:w,factura:a})})]);if(!l.ok||!d.ok)throw new Error("Error en la consulta de la factura o pasarela");const N=await l.json(),E=await d.json();P(E),N.estado==="exito"?k(N):m("No se pudieron obtener los detalles de la factura.")}catch(l){console.error("Error obteniendo detalles de factura o pasarela:",l),m("Estamos teniendo problemas técnicos. Por favor, intente más tarde.")}finally{u(!1)}})()},[]),o.useEffect(()=>{console.log(r.pm_fecha),(async()=>{try{const t=await T.get(`/admin/ajax/dolar-priceGetter?date=${r.pm_fecha}`);console.log(t),S(t.data[0].bolivares_value)}catch{}})()},[r.pm_fecha]),o.useEffect(()=>{if(c?.factura?.total2&&p){console.log("test");const s=String(c.factura.total2).replace(/[^0-9.]/g,""),t=parseFloat(s),a=parseFloat(p);console.log(t,a,"-----------"),!isNaN(t)&&!isNaN(a)&&b(l=>({...l,total:(t*a).toFixed(2)}))}},[p,c]);const i=s=>{const{name:t,value:a}=s.target;b(l=>({...l,[t]:a}))},F=async s=>{s.preventDefault(),x("");const a=new URLSearchParams(window.location.search).get("id");try{const d=await(await fetch(`${j}/cliente/ajax/bdv/pagoMovil?idfactura=${a}&action=consolidarPago`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({nfactura:a,...r})})).json();x(d.mensaje||"Pago consolidado exitosamente"),console.log("Consolidar pago response:",d),d.code==="000"&&(window.location.href="/")}catch(l){x("Error al procesar el pago"),console.error("Pago error:",l)}};return e.jsx("main",{className:"min-h-screen flex items-center justify-center bg-black-500 p-4",children:e.jsx("div",{className:"w-full max-w-md",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-2xl",children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx("img",{src:"/logo/Principal-Logo-Plano-Telecom.png",alt:"Plano logo",className:"h-28 w-auto"})}),B?e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-sky-600 mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Cargando detalles de la factura..."})]}):v?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-red-600 font-medium mb-2",children:"Error"}),e.jsx("p",{className:"text-gray-600",children:v}),e.jsx("a",{href:"/",className:"mt-4 inline-block px-4 py-2 text-sm font-medium text-white bg-sky-600 rounded-md hover:bg-sky-700",children:"Volver al inicio"})]}):e.jsxs(o.Fragment,{children:[!n&&Array.isArray(f)&&f.length>0?e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"font-bold text-gray-700 mb-2",children:"Selecciona un método de pago:"}),e.jsx("div",{className:"grid gap-3",children:f.map((s,t)=>{let a=s.target;return a.includes("-")&&(a=a.split("-").slice(1).join("-").trim()),e.jsxs("button",{className:"w-full text-left bg-white border border-sky-200 rounded-lg p-4 shadow hover:bg-sky-50 transition hover:cursor-pointer",onClick:()=>y(s),children:[e.jsx("div",{className:"font-semibold text-sky-700 text-base mb-1",children:a||"Banco"}),e.jsx("div",{className:"text-sm text-gray-600",children:s.tipo})]},t)})})]}):null,n&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-bold text-gray-700",children:"Información de pago seleccionada"}),e.jsx("button",{className:"text-sky-600 text-sm underline hover:text-sky-800",onClick:()=>y(null),type:"button",children:"Cambiar método de pago"})]}),e.jsxs("div",{className:"bg-white border border-sky-200 rounded-lg p-4 shadow",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"font-semibold",children:"Banco:"})," ",n.target]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"font-semibold",children:"Tipo:"})," ",n.tipo]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"font-semibold",children:"Cuenta:"})," ",n.cuenta]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"font-semibold",children:"Identificación:"})," ",n.identificacion]})]})]}),_&&n&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 w-full max-w-md relative",children:[e.jsx("button",{className:"absolute top-2 right-2 text-gray-500 hover:text-gray-700 text-xl",onClick:()=>D(!1),"aria-label":"Cerrar",children:"×"}),e.jsx("h3",{className:"text-lg font-bold mb-4 text-sky-700",children:"Detalles del método de pago"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Banco:"})," ",n.target]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Tipo:"})," ",n.tipo]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Cuenta:"})," ",n.cuenta]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Identificación:"})," ",n.identificacion]})]})]})}),n&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold mb-6 text-center",children:"Procesar Pago"}),e.jsxs("div",{className:"mb-4 border rounded-lg",children:[e.jsxs("button",{onClick:()=>C(!h),className:"w-full flex justify-between items-center p-4 font-semibold text-lg",children:[e.jsx("span",{children:"Detalles de Factura"}),e.jsx("svg",{className:`w-6 h-6 transition-transform transform ${h?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})})]}),h&&c&&e.jsxs("div",{className:"p-4 border-t",children:[e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsx("div",{className:"text-gray-600",children:"Número:"}),e.jsx("div",{children:c.factura.id}),e.jsx("div",{className:"text-gray-600",children:"Fecha Emisión:"}),e.jsx("div",{children:c.factura.emitido}),e.jsx("div",{className:"text-gray-600",children:"Vencimiento:"}),e.jsx("div",{children:c.factura.vencimiento}),e.jsx("div",{className:"text-gray-600",children:"Estado:"}),e.jsx("div",{children:c.factura.estado})]})}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsx("div",{className:"font-semibold text-lg px-4 py-3 border-b",children:"Items de la Factura"}),e.jsx("div",{className:"divide-y",children:c.items.map((s,t)=>e.jsx("div",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.descrp}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Cantidad: ",s.unidades," x ",s.precio2]})]}),e.jsx("div",{className:"font-semibold",children:s.total2})]})},t))}),e.jsxs("div",{className:"bg-gray-50 px-4 py-3 flex justify-between items-center font-semibold",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:c.factura.total2})]})]})]})]}),e.jsxs("form",{onSubmit:F,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Cédula"}),e.jsx("input",{type:"text",name:"pm_ced",required:!0,value:r.pm_ced,onChange:i,placeholder:"V-12345678",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-sky-500 focus:ring-sky-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Teléfono"}),e.jsx("input",{type:"tel",name:"pm_tel",required:!0,value:r.pm_tel,onChange:i,placeholder:"04121234567",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-sky-500 focus:ring-sky-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Fecha"}),e.jsx("input",{type:"date",name:"pm_fecha",required:!0,value:r.pm_fecha,onChange:i,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-sky-500 focus:ring-sky-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Banco Origen"}),e.jsxs("select",{name:"pm_banco_origen",required:!0,value:r.pm_banco_origen,onChange:i,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-sky-500 focus:ring-sky-500",children:[e.jsx("option",{value:"",children:"Seleccionar banco..."}),e.jsx("option",{value:"0001",children:"Banco Central de Venezuela"}),e.jsx("option",{value:"0102",children:"Banco de Venezuela"}),e.jsx("option",{value:"0104",children:"Banco Venezolano de Crédito"}),e.jsx("option",{value:"0105",children:"Banco Mercantil"}),e.jsx("option",{value:"0108",children:"BBVA Provincial"}),e.jsx("option",{value:"0114",children:"Bancaribe"}),e.jsx("option",{value:"0115",children:"Banco Exterior"}),e.jsx("option",{value:"0116",children:"Banco Occidental de Descuento"}),e.jsx("option",{value:"0128",children:"Banco Caroní"}),e.jsx("option",{value:"0134",children:"Banesco"}),e.jsx("option",{value:"0138",children:"Banco Plaza"}),e.jsx("option",{value:"0151",children:"BFC Banco Fondo Común"}),e.jsx("option",{value:"0156",children:"100% Banco"}),e.jsx("option",{value:"0157",children:"DelSur Banco Universal"}),e.jsx("option",{value:"0163",children:"Banco del Tesoro"}),e.jsx("option",{value:"0166",children:"Banco Agrícola de Venezuela"}),e.jsx("option",{value:"0168",children:"Bancrecer"}),e.jsx("option",{value:"0169",children:"Mi Banco"}),e.jsx("option",{value:"0171",children:"Banco Activo"}),e.jsx("option",{value:"0172",children:"Bancamiga"}),e.jsx("option",{value:"0174",children:"Banplus"}),e.jsx("option",{value:"0175",children:"Banco Bicentenario"}),e.jsx("option",{value:"0177",children:"Banfanb"}),e.jsx("option",{value:"0191",children:"Banco Nacional de Crédito"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Número de Transacción"}),e.jsx("input",{type:"text",name:"transaccion",required:!0,value:r.transaccion,onChange:i,placeholder:"123456",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-sky-500 focus:ring-sky-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Monto Total"}),e.jsx("input",{type:"number",name:"total",required:!0,value:r.total,onChange:i,step:"0.01",readOnly:!0,className:"mt-1 block w-full rounded-md border-gray-300 bg-gray-50 shadow-sm focus:border-sky-500 focus:ring-sky-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Descripción"}),e.jsx("textarea",{name:"descripcion",required:!0,value:r.descripcion,onChange:i,rows:"2",readOnly:!0,className:"mt-1 block w-full rounded-md border-gray-300 bg-gray-50 shadow-sm focus:border-sky-500 focus:ring-sky-500"})]}),e.jsxs("div",{className:"flex justify-between space-x-3 mt-6",children:[e.jsx("a",{href:"/",className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"px-4 py-2 text-sm font-medium text-white bg-sky-600 rounded-md hover:bg-sky-700",children:"Confirmar Pago"})]})]})]}),g&&e.jsx("div",{className:"mt-4 text-center text-sm font-semibold text-blue-700",children:g})]})]})})})}export{z as default};
